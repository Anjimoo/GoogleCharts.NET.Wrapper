@page "/"
@using Microsoft.JSInterop;
@inject IJSRuntime jsRuntime;

@if (@Gantt == null || @Timeline == null || !@Gantt.Drawn || !@Timeline.Drawn)
{

}
else
{
    <div style="margin-bottom: 50px">
        <GoogleGanttChart Id="mygantt" GanttDataTable="@Gantt"></GoogleGanttChart>
    </div>

    <div style="margin-top: 50px">
        <GoogleTimeline Id="mytimeline" GanttDataTable="@Timeline"></GoogleTimeline>
    </div>

    <button @onclick="RedrawChart">REDRAW</button>

}


@code{
    public DataTable<DataTableGanttRow> Gantt { get; set; }
    public DataTable<DataTableTimeLineRow> Timeline { get; set; }

    public async void RedrawChart()
    {
        await Timeline.SetOptions(new TimelineOptions
        {
            Height = 300,
            Timeline = new Timeline { ColorByRowLabel = true },
            hAxis = new hAxis { MinValue = new DateTime(2012, 1, 1), MaxValue = new DateTime(2022, 1, 1) }
        });
        await Timeline.DrawChart();
    }

    protected override async Task OnInitializedAsync()
    {
        Gantt = new DataTable<DataTableGanttRow>(jsRuntime);
        await Gantt.SetChartId("mygantt");

        Gantt.AddRow(new DataTableGanttRow
        {
            TaskId = "2014Spring",
            TaskName = "Spring 2014",
            Resource = "spring",
            StartDate = new DateTime(2014, 2, 22),
            EndDate = new DateTime(2014, 5, 20),
            Duration = null,
            PercentComplete = 100,
            Dependencies = null
        });
        Gantt.AddRow(new DataTableGanttRow
        {
            TaskId = "2014Summer",
            TaskName = "Summer 2014",
            Resource = "summer",
            StartDate = new DateTime(2014, 5, 21),
            EndDate = new DateTime(2014, 8, 20),
            Duration = null,
            PercentComplete = 100,
            Dependencies = null
        });
        Gantt.AddRow(new DataTableGanttRow
        {
            TaskId = "2015Summer",
            TaskName = "Summer 2015",
            Resource = "summer",
            StartDate = new DateTime(2015, 5, 21),
            EndDate = new DateTime(2015, 8, 20),
            Duration = null,
            PercentComplete = 100,
            Dependencies = null
        });
        Gantt.AddRow(new DataTableGanttRow
        {
            TaskId = "2014Autumn",
            TaskName = "Autumn 2014",
            Resource = "autumn",
            StartDate = new DateTime(2014, 8, 21),
            EndDate = new DateTime(2014, 11, 20),
            Duration = null,
            PercentComplete = 100,
            Dependencies = null
        });

        await Gantt.SetOptions(500);

        await Gantt.DrawChart();


        Timeline = new DataTable<DataTableTimeLineRow>(jsRuntime);
        await Timeline.SetChartId("mytimeline");
        await Timeline.SetCallbackFunctionName(DotNetObjectReference.Create(this), "ShowAlert", true);

        await Timeline.SetOptions(new TimelineOptions
        {
            Height = 300,
            Timeline = new Timeline { ColorByRowLabel = true }
        });

        Timeline.AddRow(new DataTableTimeLineRow
        {
            Name = "Beginning JavaScript",
            Room = "Magnolia Room",
            Start = new DateTime(2014, 8, 21),
            End = new DateTime(2014, 11, 20)
        });
        Timeline.AddRow(new DataTableTimeLineRow
        {
            Room = "Magnolia Room",
            Name = "Intermediate JavaScript",
            Start = new DateTime(2014, 5, 21),
            End = new DateTime(2014, 8, 20)
        });
        Timeline.AddRow(new DataTableTimeLineRow
        {
            Room = "Willow Room",
            Name = "Beginning Google Charts",
            Start = new DateTime(2014, 6, 21),
            End = new DateTime(2014, 9, 20)
        });
        Timeline.AddRow(new DataTableTimeLineRow
        {
            Room = "Willow Room",
            Name = "Advanced Google Charts",
            Start = new DateTime(2014, 3, 21),
            End = new DateTime(2014, 5, 20)
        });

        await Timeline.DrawChart();
        StateHasChanged();
    }

    [JSInvokable]
    public void ShowAlert(string name)
    {

    }


}